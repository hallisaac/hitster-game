<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Hitster Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --spotify-green: #1DB954; --dark-bg: #121212; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--dark-bg); color: white; text-align: center; margin: 0; padding: 20px; }
        #reader { width: 100%; max-width: 400px; margin: 20px auto; border-radius: 20px; overflow: hidden; border: 2px solid var(--spotify-green); background: #000; }
        #game-interface { display: none; margin-top: 20px; animation: fadeIn 0.5s; }
        .btn { background: var(--spotify-green); color: white; border: none; padding: 18px 30px; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 10px; width: 80%; max-width: 300px; }
        .btn-secondary { background: #333; }
        #answer-box { margin-top: 20px; padding: 20px; border: 1px dashed #555; border-radius: 15px; display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <h1 style="color: var(--spotify-green)">Hitster Scanner</h1>
    
    <div id="scanner-section">
        <div id="reader"></div>
        <p style="color: #888">Point camera at a Spotify QR or Link</p>
    </div>

    <div id="game-interface">
        <div id="player-container"></div>
        <br>
        <button class="btn" id="reveal-btn" onclick="revealAnswer()">Show Song & Year</button>
        <div id="answer-box">
            <h2 id="song-name">Song Name</h2>
            <p id="artist-name" style="color: var(--spotify-green)">Artist</p>
        </div>
        <button class="btn btn-secondary" onclick="resetApp()">Scan Next Card</button>
    </div>

    <script>
        let scanner = new Html5Qrcode("reader");

        function onScanSuccess(decodedText) {
            // Stop scanner to save battery/focus
            scanner.stop().then(() => {
                document.getElementById('scanner-section').style.display = 'none';
                document.getElementById('game-interface').style.display = 'block';
                
                // Extract ID from Spotify URL
                const trackId = decodedText.split('track/')[1]?.split('?')[0];
                if (trackId) {
                    loadSpotifyEmbed(trackId);
                } else {
                    alert("Not a valid Spotify track link!");
                    resetApp();
                }
            });
        }

        function loadSpotifyEmbed(id) {
            const container = document.getElementById('player-container');
            // This embed plays the 30s preview automatically
            container.innerHTML = `<iframe src="https://open.spotify.com/embed/track/${id}" width="100%" height="152" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>`;
        }

        function revealAnswer() {
            document.getElementById('answer-box').style.display = 'block';
            document.getElementById('reveal-btn').style.display = 'none';
        }

        function resetApp() {
            location.reload(); // Simplest way to reset everything
        }

        // Start Scanner
        scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess);
    </script>
</body>
</html>